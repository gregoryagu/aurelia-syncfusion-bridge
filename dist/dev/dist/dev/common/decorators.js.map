{"version":3,"sources":["common/decorators.js"],"names":["generateBindables","controlName","inputs","twoWayProperties","abbrevProperties","observerCollection","target","key","descriptor","behaviorResource","metadata","getOrCreateOwn","resource","HtmlBehaviorResource","container","Container","instance","util","get","Util","bindingInstance","BindingEngine","push","len","length","prototype","arrayObserver","forEach","element","getBindablePropertyName","twoWays","controlProperties","i","option","prop","registerProp","nameOrConfigOrTarget","name","defaultBindingMode","bindingMode","twoWay","BindableProperty","registerWith","delayed","taskQueue","TaskQueue","ptr","value","args","childPropertyName","queueTask","apply"],"mappings":"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","file":"../../../common/decorators.js","sourcesContent":["import {BindableProperty, HtmlBehaviorResource} from 'aurelia-templating';\r\nimport {Container} from 'aurelia-dependency-injection';\r\nimport {metadata} from 'aurelia-metadata';\r\nimport {TaskQueue} from 'aurelia-task-queue';\r\nimport { bindingMode, BindingEngine } from 'aurelia-binding';\r\nimport { Util } from './util';\r\n\r\nexport function generateBindables(controlName, inputs, twoWayProperties, abbrevProperties, observerCollection) {\r\n  return function(target, key, descriptor) {\r\n    let behaviorResource = metadata.getOrCreateOwn(metadata.resource, HtmlBehaviorResource, target);\r\n    let container = (Container.instance || new Container());\r\n    let util = container.get(Util);\r\n    let bindingInstance = container.get(BindingEngine);\r\n    inputs.push('options');\r\n    inputs.push('widget');\r\n    let len = inputs.length;\r\n    if (observerCollection) {\r\n      target.prototype.arrayObserver = [];\r\n      observerCollection.forEach((element) => {\r\n        target.prototype.arrayObserver.push(util.getBindablePropertyName(element));\r\n      });\r\n      target.prototype.bindingInstance = bindingInstance;\r\n    }\r\n    target.prototype.controlName = controlName;\r\n    target.prototype.twoWays = twoWayProperties ? twoWayProperties : [];\r\n    target.prototype.abbrevProperties = abbrevProperties ? abbrevProperties : [];\r\n    if (len) {\r\n      target.prototype.controlProperties = inputs;\r\n      for (let i = 0; i < len; i++) {\r\n        let option = inputs[i];\r\n        if (abbrevProperties && option in abbrevProperties) {\r\n          option = abbrevProperties[option];\r\n          option.forEach((prop) => {\r\n            registerProp(util, prop, target, behaviorResource, descriptor);\r\n          });\r\n        } else {\r\n          registerProp(util, option, target, behaviorResource, descriptor);\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nfunction registerProp(util, option, target, behaviorResource, descriptor) {\r\n  let nameOrConfigOrTarget = {\r\n    name: util.getBindablePropertyName(option)\r\n  };\r\n\r\n  if (option === 'widget') {\r\n    nameOrConfigOrTarget.defaultBindingMode = bindingMode.twoWay;\r\n  }\r\n\r\n  let prop = new BindableProperty(nameOrConfigOrTarget);\r\n  prop.registerWith(target, behaviorResource, descriptor);\r\n}\r\n\r\nexport function delayed() {\r\n  return function(target, key, descriptor) {\r\n    let taskQueue = (Container.instance || new Container()).get(TaskQueue);\r\n    let ptr = descriptor.value;\r\n\r\n    descriptor.value = function(...args) {\r\n      if (this.childPropertyName) {\r\n        taskQueue.queueTask(() => ptr.apply(this, args));\r\n      } else {\r\n        ptr.apply(this, args);\r\n      }\r\n    };\r\n\r\n    return descriptor;\r\n  };\r\n}\r\n"]}